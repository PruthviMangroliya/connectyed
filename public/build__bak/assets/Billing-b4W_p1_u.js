import{_ as y,M as C,x as k,e as i,f as r,p as h,t as n,i as l,g,w as f,F as x,z as v,k as w,v as D,m as P,o,n as M,q as S,s as I}from"./app-Cq5k9qoS.js";import{P as R}from"./PricingComparison-Byr0BnWr.js";const E={name:"Billing",components:{PricingComparison:R},data(){return{products:[{id:"silver_package",name:"Silver Package",description:"1 on 1 Blind Date - Choose up to 4 criteria",originalPrice:9900,discountedPrice:5e3,stripePriceId:"price_1Q6dwmFZef913bMWLjDn3QTZ",rank:1},{id:"gold_package",name:"Gold Package",description:"1 on 1 Curated Date - Includes Matchmaker Call",originalPrice:24900,discountedPrice:14900,stripePriceId:"price_1QEIiBFZef913bMWY56u5lcS",rank:2},{id:"platinum_package",name:"Platinum Package",description:"1 on 1 Premium Date - Includes Matchmaker Call",originalPrice:49900,discountedPrice:24900,stripePriceId:"price_1QEIjGFZef913bMWMV75AZ1n",rank:3}],processing:!1,showDiscountModal:!1,selectedProduct:null,discountCode:""}},computed:{...C({user:e=>e.auth.user,authorization:e=>e.auth.authorization}),hasPackage(){var e;return!!((e=this.user)!=null&&e.purchased_package)},userCriteriaCount(){var e;if(!((e=this.user)!=null&&e.criteria))return 0;try{return JSON.parse(this.user.criteria).length}catch(t){return console.error("Error parsing criteria:",t),0}},availableProducts(){if(!this.hasPackage)return this.products;const e=this.getPackageRank(this.user.purchased_package);return this.products.filter(t=>this.getPackageRank(t.id)>=e)}},methods:{formatPackageName(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""},formatDate(e){return e?new Date(e).toLocaleDateString():""},getPackageRank(e){if(!e)return 0;const t=this.products.find(c=>c.id===e||c.id===`${e}_package`);return t?t.rank:0},canPurchasePackage(e){if(!this.hasPackage)return!0;if(this.isCurrentPackage(e))return!1;const t=this.getPackageRank(this.user.purchased_package);return this.getPackageRank(e)>t},isCurrentPackage(e){if(!this.hasPackage)return!1;const t=e.replace("_package","");return this.user.purchased_package===t},getButtonText(e){return this.isCurrentPackage(e)?"Current Package":e==="silver_package"?"Send Your Request":this.canPurchasePackage(e)?this.hasPackage?"Upgrade":"Purchase":"Lower Tier"},async handleSilverPackageRequest(){var e,t;this.processing=!0;try{const c=await k.post("/api/free-blind-date-request",{},{headers:{Authorization:`Bearer ${this.authorization.token}`}});c.data.message?alert("Your request for the Silver Package has been successfully sent!"):alert(c.data.message||"Failed to send your request. Please try again.")}catch(c){console.error("Error Sending Request:",c),(t=(e=c.response)==null?void 0:e.data)!=null&&t.message?alert(`Error: ${c.response.data.message}`):alert("An unexpected error occurred. Please try again later.")}finally{this.processing=!1}},buttonLabel(e){return`${this.hasPackage?"Upgrade to":"Purchase"} ${e.name}`},openDiscountModal(e){this.selectedProduct=e,this.showDiscountModal=!0},closeDiscountModal(){this.showDiscountModal=!1,this.selectedProduct=null,this.discountCode=""},async confirmPurchase(){var e,t;if(this.selectedProduct){this.processing=!0;try{const c={product_type:this.selectedProduct.id,price_id:this.selectedProduct.stripePriceId,discount_code:this.discountCode||null},d=await k.post("/api/billing/create-checkout-session",c,{headers:{Authorization:`Bearer ${this.authorization.token}`}});d.data.success&&d.data.checkout_url?(d.data.is_first_purchase&&localStorage.setItem("redirect_after_payment","/client/criteria"),window.location.href=d.data.checkout_url):(console.error("Failed to create checkout session:",d.data.message),alert(d.data.message||"Failed to create checkout session. Please try again."))}catch(c){console.error("Error creating checkout session:",c),(t=(e=c.response)==null?void 0:e.data)!=null&&t.message?alert(`Error: ${c.response.data.message}`):alert("An unexpected error occurred. Please try again later.")}finally{this.processing=!1,this.closeDiscountModal()}}}},watch:{user:{immediate:!0,handler(e){e!=null&&e.purchased_package||this.$router.push("/client/billing")}}},created(){if(new URLSearchParams(window.location.search).get("session_id")){const c=localStorage.getItem("redirect_after_payment");c&&(localStorage.removeItem("redirect_after_payment"),this.$store.dispatch("auth/getUser").then(()=>{this.$router.push(c)}).catch(d=>{console.error("Error refreshing user data after payment:",d),this.$router.push("/client/billing")}))}}},p=e=>(S("data-v-093c3d17"),e=e(),I(),e),B={class:"container mx-auto p-4"},F={key:0,class:"mb-8 bg-white p-6 rounded-lg shadow"},z=p(()=>r("h2",{class:"text-xl font-bold mb-4"},"Current Package",-1)),N={class:"flex justify-between items-center"},q={class:"text-lg"},T={class:"text-sm text-gray-600 ml-2"},j={class:"text-gray-600 mt-2"},L={key:0,class:"ml-2"},A={key:1,class:"mb-8 bg-white p-6 rounded-lg shadow"},U={class:"flex justify-between items-center"},V=p(()=>r("h2",{class:"text-xl font-bold"},"Match Criteria",-1)),Y={class:"text-gray-600 mt-2"},Z={key:0,class:"ml-2"},Q={key:0},W={key:1},G={class:"mb-6"},O={class:"text-xl font-bold mb-2"},J={key:0,class:"text-gray-600"},H={key:1,class:"text-gray-600"},K={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 mt-6"},X={key:0,class:"absolute top-0 left-0 bg-yellow-500 text-blue-700 font-bold px-3 py-1 transform -rotate-45 shadow-md z-10 mt-6",style:{"transform-origin":"top left","margin-top":"2.9rem","margin-left":"-2.6rem"}},$={key:1,class:"absolute top-0 right-0 bg-blue-500 text-white px-3 py-1 rounded-bl"},ee={class:"text-lg font-semibold mb-2"},te={class:"text-gray-700 mb-4"},ae={class:"text-xl font-bold mb-2"},se={key:0,class:"line-through text-gray-500"},re={key:1,class:"text-green-600"},ie={key:2,class:"text-green-600"},oe=["onClick","disabled","aria-label"],ce={key:0},ne={key:1},le={key:2,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50","aria-modal":"true",role:"dialog","aria-labelledby":"discount-code-modal-title"},de={class:"bg-white p-6 rounded-lg shadow-lg w-80"},ue=p(()=>r("h3",{id:"discount-code-modal-title",class:"text-lg font-semibold mb-4"},"Enter Discount Code",-1)),he={class:"flex justify-end"},ge=["disabled"],pe={key:0},_e={key:1};function me(e,t,c,d,u,s){const _=P("router-link"),b=P("PricingComparison");return o(),i("div",B,[s.hasPackage?(o(),i("div",F,[z,r("div",N,[r("div",null,[r("p",q,[h(n(s.formatPackageName(e.user.purchased_package))+" Package ",1),r("span",T," (Purchased "+n(s.formatDate(e.user.package_purchased_at))+") ",1)]),r("p",j,[h(" Criteria limit: "+n(e.user.criteria_limit)+" ",1),s.userCriteriaCount!==null?(o(),i("span",L," ("+n(s.userCriteriaCount)+" used) ",1)):l("",!0)])]),g(_,{to:"/client/criteria",class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition duration-200","aria-label":"Manage Criteria"},{default:f(()=>[h(" Manage Criteria ")]),_:1})])])):l("",!0),s.hasPackage?(o(),i("div",A,[r("div",U,[r("div",null,[V,r("p",Y,[h(" Set your match preferences to find your perfect match! "),s.userCriteriaCount>0?(o(),i("span",Z," ("+n(s.userCriteriaCount)+"/"+n(e.user.criteria_limit)+" criteria set) ",1)):l("",!0)])]),g(_,{to:"/client/criteria",class:"px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition duration-200 flex items-center space-x-2","aria-label":"Set or Update Match Criteria"},{default:f(()=>[s.userCriteriaCount>0?(o(),i("span",Q,"Update Criteria")):(o(),i("span",W,"Set Your Criteria"))]),_:1})])])):l("",!0),r("div",G,[r("h2",O,n(s.hasPackage?"Upgrade Your Package":"Dating Packages")+"fmatch ",1),s.hasPackage?(o(),i("p",J," Upgrade to get access to more criteria and better matches! ")):(o(),i("p",H," Choose a package to start your dating journey! "))]),g(b),r("div",K,[(o(!0),i(x,null,v(s.availableProducts,a=>{var m;return o(),i("div",{key:a.id,class:"bg-white p-6 rounded-lg shadow relative"},[a.id==="silver_package"?(o(),i("div",X," TRY IT NOW! ")):l("",!0),s.isCurrentPackage(a.id)?(o(),i("div",$," Current ")):l("",!0),r("h3",ee,n(a.name),1),r("p",te,n(a.description),1),r("p",ae,[a.id!=="silver_package"?(o(),i("span",se," $"+n((a.originalPrice/100).toFixed(2)),1)):l("",!0),a.id!=="silver_package"?(o(),i("span",re," $"+n((a.discountedPrice/100).toFixed(2)),1)):l("",!0),a.id==="silver_package"?(o(),i("span",ie," FREE ")):l("",!0)]),r("button",{onClick:ke=>a.id==="silver_package"?(u.selectedProduct=a,s.handleSilverPackageRequest()):s.openDiscountModal(a),disabled:!s.canPurchasePackage(a.id)||u.processing,class:M(["w-full py-2 px-4 rounded transition duration-200",s.isCurrentPackage(a.id)?"bg-gray-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white"]),"aria-label":s.buttonLabel(a)},[u.processing&&((m=u.selectedProduct)==null?void 0:m.id)===a.id?(o(),i("span",ce," Processing... ")):(o(),i("span",ne,n(s.getButtonText(a.id)),1))],10,oe)])}),128))]),u.showDiscountModal?(o(),i("div",le,[r("div",de,[ue,w(r("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>u.discountCode=a),type:"text",placeholder:"Discount Code",class:"w-full px-3 py-2 border rounded mb-4","aria-label":"Discount Code"},null,512),[[D,u.discountCode]]),r("div",he,[r("button",{onClick:t[1]||(t[1]=(...a)=>s.closeDiscountModal&&s.closeDiscountModal(...a)),class:"mr-2 px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400","aria-label":"Cancel Discount Code Entry"}," Cancel "),r("button",{onClick:t[2]||(t[2]=(...a)=>s.confirmPurchase&&s.confirmPurchase(...a)),disabled:u.processing,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition duration-200 disabled:bg-blue-300","aria-label":"Confirm Discount Code"},[u.processing?(o(),i("span",pe,"Processing...")):(o(),i("span",_e,"Confirm"))],8,ge)])])])):l("",!0)])}const be=y(E,[["render",me],["__scopeId","data-v-093c3d17"]]);export{be as default};
