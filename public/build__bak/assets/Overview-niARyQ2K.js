import{_ as f,x as u,e as r,f as e,F as g,z as y,i as n,o as i,n as x,t as o,k as b,v as w,O as v,q as C,s as k}from"./app-Cq5k9qoS.js";import{f as M}from"./index-_1v56OQN.js";const S={name:"AdminOverview",data(){return{activeMainTab:"supportMessages",mainTabs:[{id:"supportMessages",name:"Support Messages"},{id:"withdrawalsComplaints",name:"Withdrawals & Complaints"}],activeSubTab:"withdrawals",subTabs:[{id:"withdrawals",name:"Withdrawal Requests"},{id:"complaints",name:"Meeting Complaints"}],messages:[],replies:{},loadingMessages:!1,withdrawalRequests:[],loadingWithdrawals:!1,complaints:[],loadingComplaints:!1}},computed:{groupedConversations(){const t={};return this.messages.forEach(a=>{const c=a.sender_id===1?a.receiver_id:a.sender_id,_=a.sender_id===1?a.receiver:a.sender;t[c]||(t[c]={userId:c,userName:_.name,userEmail:_.email,userRole:_.role,package:_.purchased_package,messages:[],lastMessage:a}),t[c].messages.push(a),new Date(a.created_at)>new Date(t[c].lastMessage.created_at)&&(t[c].lastMessage=a)}),Object.values(t).sort((a,c)=>new Date(c.lastMessage.created_at)-new Date(a.lastMessage.created_at))}},methods:{formatDate(t){return M(new Date(t),"MMM d, yyyy h:mm a")},capitalize(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""},async fetchSupportMessages(){try{this.loadingMessages=!0;const t=await u.get("/api/messages");t.data.success&&(this.messages=t.data.data.filter(a=>a.sender_id===1||a.receiver_id===1))}catch(t){console.error("Error fetching support messages:",t),this.$toast.error("Failed to fetch support messages")}finally{this.loadingMessages=!1}},async sendReply(t){const a=this.replies[t];if(a!=null&&a.trim())try{this.loadingMessages=!0;const c=await u.post("/api/messages/send",{receiver_id:t,message:a});c.data.success&&(this.messages.push(c.data.data),this.$set(this.replies,t,""),await this.fetchSupportMessages())}catch(c){console.error("Error sending reply:",c),this.$toast.error("Failed to send reply")}finally{this.loadingMessages=!1}},async fetchWithdrawals(){try{this.loadingWithdrawals=!0;const t=await u.get("/api/admin/withdrawals");t.data.success?this.withdrawalRequests=t.data.data:this.$toast.error("Failed to fetch withdrawal requests")}catch(t){console.error("Error fetching withdrawals:",t),this.$toast.error("Failed to fetch withdrawal requests")}finally{this.loadingWithdrawals=!1}},async approveWithdrawal(t){try{await u.post(`/api/admin/withdrawals/${t}/approve`),this.$toast.success("Withdrawal request approved"),await this.fetchWithdrawals()}catch(a){console.error("Error approving withdrawal:",a),this.$toast.error("Failed to approve withdrawal")}},async rejectWithdrawal(t){try{await u.post(`/api/admin/withdrawals/${t}/reject`),this.$toast.success("Withdrawal request rejected"),await this.fetchWithdrawals()}catch(a){console.error("Error rejecting withdrawal:",a),this.$toast.error("Failed to reject withdrawal")}},getRoleClass(t){return{matchmaker:"bg-blue-100 text-blue-800",client:"bg-green-100 text-green-800"}[t]||"bg-gray-100 text-gray-800"},getStatusClass(t){return{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"},async fetchComplaints(){try{this.loadingComplaints=!0;const t=await u.get("/api/admin/complaints");t.data.success?this.complaints=t.data.data:this.$toast.error("Failed to fetch complaints")}catch(t){console.error("Error fetching complaints:",t),this.$toast.error("Failed to fetch complaints")}finally{this.loadingComplaints=!1}},async resolveComplaint(t){try{await u.post(`/api/admin/complaints/${t}/resolve`),this.$toast.success("Complaint resolved"),await this.fetchComplaints()}catch(a){console.error("Error resolving complaint:",a),this.$toast.error("Failed to resolve complaint")}},async refundMeeting(t){try{await u.post(`/api/admin/meetings/${t}/refund`),this.$toast.success("Meeting refunded successfully"),await this.fetchComplaints()}catch(a){console.error("Error refunding meeting:",a),this.$toast.error("Failed to refund meeting")}},getComplaintStatusClass(t){return{pending:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800",refunded:"bg-blue-100 text-blue-800"}[t]||"bg-gray-100 text-gray-800"}},watch:{activeMainTab(t){t==="supportMessages"?this.fetchSupportMessages():t==="withdrawalsComplaints"&&(this.fetchWithdrawals(),this.fetchComplaints())},activeSubTab(t){t==="withdrawals"?this.fetchWithdrawals():t==="complaints"&&this.fetchComplaints()}},mounted(){this.fetchSupportMessages()},beforeDestroy(){}},m=t=>(C("data-v-7972c1cf"),t=t(),k(),t),R={class:"p-6"},T=m(()=>e("h2",{class:"text-2xl font-bold mb-6"},"Admin Dashboard",-1)),W={class:"border-b border-gray-200 mb-6"},D={class:"-mb-px flex space-x-8"},E=["onClick"],F={key:0},j={class:"bg-white rounded-lg shadow p-6"},I=m(()=>e("h3",{class:"text-xl font-semibold mb-4"},"Support Messages",-1)),z={class:"space-y-6"},N={class:"bg-gray-50 p-4 rounded-t-lg mb-4"},A={class:"flex justify-between items-start"},O={class:"font-semibold text-lg"},U={class:"text-sm text-gray-600"},V={class:"mt-1 flex items-center space-x-2"},B={key:0,class:"px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800"},K={class:"text-sm text-gray-500"},P={class:"space-y-3 max-h-96 overflow-y-auto mb-4 p-4 bg-gray-50 rounded-lg"},L={class:"flex justify-between items-center mb-1"},Y={class:"text-xs font-semibold"},q={class:"text-xs text-gray-500"},G={class:"text-gray-800"},H={class:"flex gap-2 bg-white p-2 rounded-lg"},J=["onUpdate:modelValue","onKeyup"],Q=["onClick","disabled"],X={key:0,class:"text-center text-gray-500 py-8"},Z={key:1,class:"space-y-6"},$={class:"border-b border-gray-200 mb-6"},ee={class:"-mb-px flex space-x-8"},te=["onClick"],se={key:0,class:"space-y-6"},ae={class:"bg-white shadow rounded-lg overflow-hidden"},re={class:"min-w-full divide-y divide-gray-200"},ie=m(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"User"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Role"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Amount"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"PayPal Email"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),oe={class:"bg-white divide-y divide-gray-200"},le={class:"px-6 py-4"},de={class:"text-sm font-medium text-gray-900"},ce={class:"text-sm text-gray-500"},ne={class:"px-6 py-4"},pe={class:"px-6 py-4"},he={class:"px-6 py-4"},ue={class:"px-6 py-4"},ge={class:"px-6 py-4 space-x-2"},xe=["onClick"],ye=["onClick"],_e={key:0,class:"text-center text-gray-500 py-4"},me={key:1,class:"space-y-6"},fe={class:"bg-white shadow rounded-lg overflow-hidden"},be={class:"min-w-full divide-y divide-gray-200"},we=m(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Meeting"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Client"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Matchmaker"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Complaint"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),e("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),ve={class:"bg-white divide-y divide-gray-200"},Ce={class:"px-6 py-4"},ke={class:"text-sm"},Me={class:"text-xs text-gray-500"},Se={class:"px-6 py-4"},Re={class:"px-6 py-4"},Te={class:"px-6 py-4"},We={class:"text-sm"},De={class:"px-6 py-4"},Ee={class:"px-6 py-4 space-x-2"},Fe=["onClick"],je=["onClick"],Ie={key:0,class:"text-center text-gray-500 py-4"};function ze(t,a,c,_,d,l){return i(),r("div",R,[T,e("div",W,[e("nav",D,[(i(!0),r(g,null,y(d.mainTabs,s=>(i(),r("button",{key:s.id,onClick:h=>d.activeMainTab=s.id,class:x(["py-4 px-1 border-b-2 font-medium text-sm",d.activeMainTab===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},o(s.name),11,E))),128))])]),d.activeMainTab==="supportMessages"?(i(),r("div",F,[e("div",j,[I,e("div",z,[(i(!0),r(g,null,y(l.groupedConversations,s=>{var h;return i(),r("div",{key:s.userId,class:"border rounded-lg p-4"},[e("div",N,[e("div",A,[e("div",null,[e("h4",O,o(s.userName),1),e("p",U,o(s.userEmail),1),e("div",V,[e("span",{class:x(["px-2 py-1 text-xs rounded-full",s.userRole==="client"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"])},o(l.capitalize(s.userRole)),3),s.userRole==="client"&&s.package?(i(),r("span",B,o(l.capitalize(s.package))+" Package ",1)):n("",!0)])]),e("span",K," Last active: "+o(l.formatDate(s.lastMessage.created_at)),1)])]),e("div",P,[(i(!0),r(g,null,y(s.messages,p=>(i(),r("div",{key:p.id,class:x(["p-3 rounded-lg max-w-[80%]",p.sender_id===1?"bg-blue-100 ml-auto":"bg-white mr-auto"])},[e("div",L,[e("span",Y,o(p.sender_id===1?"You":s.userName),1),e("span",q,o(l.formatDate(p.created_at)),1)]),e("p",G,o(p.message),1)],2))),128))]),e("div",H,[b(e("input",{"onUpdate:modelValue":p=>d.replies[s.userId]=p,type:"text",placeholder:"Type your reply...",class:"flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyup:v(p=>l.sendReply(s.userId),["enter"])},null,40,J),[[w,d.replies[s.userId]]]),e("button",{onClick:p=>l.sendReply(s.userId),class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",disabled:!((h=d.replies[s.userId])!=null&&h.trim())}," Reply ",8,Q)])])}),128)),l.groupedConversations.length===0?(i(),r("div",X," No support messages yet ")):n("",!0)])])])):n("",!0),d.activeMainTab==="withdrawalsComplaints"?(i(),r("div",Z,[e("div",$,[e("nav",ee,[(i(!0),r(g,null,y(d.subTabs,s=>(i(),r("button",{key:s.id,onClick:h=>d.activeSubTab=s.id,class:x(["py-4 px-1 border-b-2 font-medium text-sm",d.activeSubTab===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},o(s.name),11,te))),128))])]),d.activeSubTab==="withdrawals"?(i(),r("div",se,[e("div",ae,[e("table",re,[ie,e("tbody",oe,[(i(!0),r(g,null,y(d.withdrawalRequests,s=>(i(),r("tr",{key:s.id},[e("td",le,[e("div",de,o(s.user.name),1),e("div",ce,o(s.user.email),1)]),e("td",ne,[e("span",{class:x(["px-2 py-1 text-xs rounded-full capitalize",l.getRoleClass(s.user.role)])},o(l.capitalize(s.user.role)),3)]),e("td",pe,"$"+o(s.amount.toFixed(2)),1),e("td",he,o(s.payment_email),1),e("td",ue,[e("span",{class:x(["px-2 py-1 text-xs rounded-full",l.getStatusClass(s.status)])},o(l.capitalize(s.status)),3)]),e("td",ge,[s.status==="pending"?(i(),r(g,{key:0},[e("button",{onClick:h=>l.approveWithdrawal(s.id),class:"text-green-600 hover:text-green-900"}," Approve ",8,xe),e("button",{onClick:h=>l.rejectWithdrawal(s.id),class:"text-red-600 hover:text-red-900"}," Reject ",8,ye)],64)):n("",!0)])]))),128))])]),d.withdrawalRequests.length===0?(i(),r("div",_e," No withdrawal requests found. ")):n("",!0)])])):n("",!0),d.activeSubTab==="complaints"?(i(),r("div",me,[e("div",fe,[e("table",be,[we,e("tbody",ve,[(i(!0),r(g,null,y(d.complaints,s=>(i(),r("tr",{key:s.id},[e("td",Ce,[e("div",ke,"#"+o(s.meeting_id),1),e("div",Me,o(l.formatDate(s.meeting.start_time)),1)]),e("td",Se,o(s.client.name),1),e("td",Re,o(s.meeting.matchmaker.name),1),e("td",Te,[e("div",We,o(s.complaint_text),1)]),e("td",De,[e("span",{class:x(["px-2 py-1 text-xs rounded-full",l.getComplaintStatusClass(s.status)])},o(l.capitalize(s.status)),3)]),e("td",Ee,[s.status==="pending"?(i(),r(g,{key:0},[e("button",{onClick:h=>l.resolveComplaint(s.id),class:"text-green-600 hover:text-green-900"}," Resolve ",8,Fe),e("button",{onClick:h=>l.refundMeeting(s.meeting_id),class:"text-blue-600 hover:text-blue-900"}," Issue Refund ",8,je)],64)):n("",!0)])]))),128))])]),d.complaints.length===0?(i(),r("div",Ie," No complaints found. ")):n("",!0)])])):n("",!0)])):n("",!0)])}const Oe=f(S,[["render",ze],["__scopeId","data-v-7972c1cf"]]);export{Oe as default};
