import{r as F,t as C,f as O}from"./index-_1v56OQN.js";import{_ as D,x as h,o as d,e as l,f as i,F as b,z as x,t as c,p as Y,j as $,k as M,L as j,v as N,q as U,s as k,n as B,O as q}from"./app-Cq5k9qoS.js";var z=6e4,I=36e5;function qe(e,s){var r;F(1,arguments);var a=C((r=void 0)!==null&&r!==void 0?r:2);if(a!==2&&a!==1&&a!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var t=L(e),o;if(t.date){var n=V(t.date,a);o=W(n.restDateString,n.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var f=o.getTime(),u=0,m;if(t.time&&(u=R(t.time),isNaN(u)))return new Date(NaN);if(t.timezone){if(m=H(t.timezone),isNaN(m))return new Date(NaN)}else{var g=new Date(f+u),y=new Date(0);return y.setFullYear(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()),y.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds()),y}return new Date(f+u+m)}var _={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},A=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,E=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Z=/^([+-])(\d{2})(?::?(\d{2}))?$/;function L(e){var s={},r=e.split(_.dateTimeDelimiter),a;if(r.length>2)return s;if(/:/.test(r[0])?a=r[0]:(s.date=r[0],a=r[1],_.timeZoneDelimiter.test(s.date)&&(s.date=e.split(_.timeZoneDelimiter)[0],a=e.substr(s.date.length,e.length))),a){var t=_.timezone.exec(a);t?(s.time=a.replace(t[1],""),s.timezone=t[1]):s.time=a}return s}function V(e,s){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};var t=a[1]?parseInt(a[1]):null,o=a[2]?parseInt(a[2]):null;return{year:o===null?t:o*100,restDateString:e.slice((a[1]||a[2]).length)}}function W(e,s){if(s===null)return new Date(NaN);var r=e.match(A);if(!r)return new Date(NaN);var a=!!r[4],t=p(r[1]),o=p(r[2])-1,n=p(r[3]),f=p(r[4]),u=p(r[5])-1;if(a)return Q(s,f,u)?P(s,f,u):new Date(NaN);var m=new Date(0);return!J(s,o,n)||!G(s,t)?new Date(NaN):(m.setUTCFullYear(s,o,Math.max(t,n)),m)}function p(e){return e?parseInt(e):1}function R(e){var s=e.match(E);if(!s)return NaN;var r=w(s[1]),a=w(s[2]),t=w(s[3]);return X(r,a,t)?r*I+a*z+t*1e3:NaN}function w(e){return e&&parseFloat(e.replace(",","."))||0}function H(e){if(e==="Z")return 0;var s=e.match(Z);if(!s)return 0;var r=s[1]==="+"?-1:1,a=parseInt(s[2]),t=s[3]&&parseInt(s[3])||0;return ee(a,t)?r*(a*I+t*z):NaN}function P(e,s,r){var a=new Date(0);a.setUTCFullYear(e,0,4);var t=a.getUTCDay()||7,o=(s-1)*7+r+1-t;return a.setUTCDate(a.getUTCDate()+o),a}var K=[31,null,31,30,31,30,31,31,30,31,30,31];function S(e){return e%400===0||e%4===0&&e%100!==0}function J(e,s,r){return s>=0&&s<=11&&r>=1&&r<=(K[s]||(S(e)?29:28))}function G(e,s){return s>=1&&s<=(S(e)?366:365)}function Q(e,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function X(e,s,r){return e===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&e>=0&&e<25}function ee(e,s){return s>=0&&s<=59}const se={name:"Messaging",props:{currentUser:{type:Object,required:!0},authorization:{type:Object,required:!0}},data(){return{messages:[],users:[],loading:!1,sending:!1,newMessage:{receiver_id:null,message:""},adminId:1}},computed:{user(){return this.currentUser}},mounted(){this.fetchMessages(),this.fetchUsers()},methods:{async fetchMessages(){this.loading=!0;try{const e=await h.get("/api/messages",{headers:{Authorization:`Bearer ${this.authorization.token}`}});e.data.success?(this.messages=e.data.data.filter(s=>s.sender_id!==this.adminId&&s.receiver_id!==this.adminId),console.log("Filtered Messages:",this.messages)):alert(e.data.message||"Failed to fetch messages.")}catch(e){console.error("Error fetching messages:",e.response||e),e.response&&e.response.status===403?alert("You are not authorized to view messages."):alert("Failed to fetch messages. Please try again.")}finally{this.loading=!1}},async fetchUsers(){try{if(!this.user){console.error("User is not defined");return}if(this.user.role==="matchmaker"){const e=await h.get("/api/clients/all?fetch_all=true",{headers:{Authorization:`Bearer ${this.authorization.token}`}});e.data.success?(this.users=e.data.data.filter(s=>s.id!==this.adminId),console.log("Fetched Clients:",this.users)):alert(e.data.message||"Failed to fetch clients.")}else if(this.user.role==="client"){const e=await h.get("/api/matchmakers/",{headers:{Authorization:`Bearer ${this.authorization.token}`}});e.data.success?(this.users=e.data.data.filter(s=>s.id!==this.adminId),console.log("Fetched Matchmakers:",this.users)):alert(e.data.message||"Failed to fetch matchmakers.")}else alert("Your role does not have messaging capabilities.")}catch(e){console.error("Error fetching users for messaging:",e.response||e),e.response&&e.response.status===403?alert("You are not authorized to view users."):alert("Failed to fetch users for messaging.")}},async sendMessage(){if(!this.newMessage.receiver_id||!this.newMessage.message.trim()){alert("Please select a user and type a message.");return}this.sending=!0;try{const e=await h.post("/api/messages/send",this.newMessage,{headers:{Authorization:`Bearer ${this.authorization.token}`}});e.data.success?(alert("Message sent successfully."),this.newMessage.message="",this.fetchMessages()):alert(e.data.message||"Failed to send message.")}catch(e){console.error("Error sending message:",e.response||e),e.response&&e.response.status===403?alert("You are not authorized to send messages."):alert("Failed to send message. Please try again.")}finally{this.sending=!1}},getOtherUser(e){return e.sender_id===this.user.id?this.users.find(s=>s.id===e.receiver_id)||{name:"Unknown"}:this.users.find(s=>s.id===e.sender_id)||{name:"Unknown"}},formatDate(e){const s={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(e).toLocaleDateString(void 0,s)}}},v=e=>(U("data-v-628acaae"),e=e(),k(),e),te={class:"messaging-container"},re=v(()=>i("h3",{class:"text-lg font-semibold mb-4"},"Messages",-1)),ae={class:"messages-list mb-4"},ne={key:0,class:"text-center"},ie={key:1},oe={key:0,class:"text-center text-gray-500"},de={key:1},le={class:"text-xs text-gray-500"},ce={class:"send-message-form"},ue=v(()=>i("h4",{class:"text-md font-semibold mb-2"},"Send a Message",-1)),ge={class:"mb-4"},me=v(()=>i("label",{for:"receiver",class:"block text-sm font-medium text-gray-700"},"To:",-1)),he=v(()=>i("option",{disabled:"",value:""},"Select a user",-1)),fe=["value"],pe={class:"mb-4"},ve=v(()=>i("label",{for:"message",class:"block text-sm font-medium text-gray-700"},"Message:",-1)),_e=["disabled"];function ye(e,s,r,a,t,o){return d(),l("div",te,[re,i("div",ae,[t.loading?(d(),l("div",ne,"Loading messages...")):(d(),l("div",ie,[t.messages.length===0?(d(),l("div",oe," No messages found. ")):(d(),l("ul",de,[(d(!0),l(b,null,x(t.messages,n=>(d(),l("li",{key:n.id,class:"mb-2 p-4 border rounded bg-gray-50"},[i("p",null,[i("strong",null,c(o.getOtherUser(n).name)+":",1),Y(" "+c(n.message),1)]),i("p",le,c(o.formatDate(n.created_at)),1)]))),128))]))]))]),i("div",ce,[ue,i("form",{onSubmit:s[2]||(s[2]=$((...n)=>o.sendMessage&&o.sendMessage(...n),["prevent"]))},[i("div",ge,[me,M(i("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>t.newMessage.receiver_id=n),required:"",class:"w-full px-3 py-2 border rounded"},[he,(d(!0),l(b,null,x(t.users,n=>(d(),l("option",{key:n.id,value:n.id},c(n.name),9,fe))),128))],512),[[j,t.newMessage.receiver_id]])]),i("div",pe,[ve,M(i("textarea",{"onUpdate:modelValue":s[1]||(s[1]=n=>t.newMessage.message=n),required:"",rows:"3",class:"w-full px-3 py-2 border rounded",placeholder:"Type your message here..."},null,512),[[N,t.newMessage.message]])]),i("button",{type:"submit",disabled:t.sending,class:"w-full py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200"},c(t.sending?"Sending...":"Send Message"),9,_e)],32)])])}const Ae=D(se,[["render",ye],["__scopeId","data-v-628acaae"]]),we={name:"Support",props:{currentUser:{type:Object,required:!0},authorization:{type:Object,required:!0}},data(){return{messages:[],newMessage:"",adminId:1,sending:!1}},computed:{sortedMessages(){return[...this.messages].sort((e,s)=>new Date(e.created_at)-new Date(s.created_at))}},methods:{formatDate(e){return O(new Date(e),"MMM d, yyyy h:mm a")},async fetchMessages(){try{const e=await h.get("/api/messages",{headers:{Authorization:`Bearer ${this.authorization.token}`}});e.data.success?this.messages=e.data.data.filter(s=>s.sender_id===this.currentUser.id&&s.receiver_id===this.adminId||s.sender_id===this.adminId&&s.receiver_id===this.currentUser.id):console.error("Failed to fetch messages:",e.data.message)}catch(e){console.error("Error fetching messages:",e)}},async sendMessage(){if(this.newMessage.trim()){this.sending=!0;try{const e=await h.post("/api/messages/send",{receiver_id:this.adminId,message:this.newMessage.trim()},{headers:{Authorization:`Bearer ${this.authorization.token}`}});e.data.success?(this.messages.push(e.data.data),this.newMessage=""):alert(e.data.message||"Failed to send message.")}catch(e){console.error("Error sending message:",e),alert("An error occurred while sending the message.")}finally{this.sending=!1}}}},mounted(){this.fetchMessages()}},T=e=>(U("data-v-71704629"),e=e(),k(),e),be={class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},xe={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4"},Me={class:"flex justify-between items-center mb-4"},De=T(()=>i("h3",{class:"text-lg font-semibold"},"Support Messages",-1)),Ne=T(()=>i("span",{class:"text-2xl"},"Ã—",-1)),Ue=[Ne],ke={class:"h-96 overflow-y-auto mb-4 border rounded-lg p-4"},ze={key:0,class:"text-center text-gray-500 py-4"},Ie={key:1},Se={class:"flex justify-between items-start"},Te={class:"font-semibold text-sm"},Fe={class:"text-xs text-gray-500"},Ce={class:"mt-1"},Oe={class:"flex gap-2"},Ye=["disabled"];function $e(e,s,r,a,t,o){return d(),l("div",be,[i("div",xe,[i("div",Me,[De,i("button",{onClick:s[0]||(s[0]=n=>e.$emit("close")),class:"text-gray-500 hover:text-gray-700"},Ue)]),i("div",ke,[t.messages.length===0?(d(),l("div",ze," No support messages yet. Start a conversation! ")):(d(),l("div",Ie,[(d(!0),l(b,null,x(o.sortedMessages,n=>(d(),l("div",{key:n.id,class:B(["mb-4 p-3 rounded-lg",n.sender_id===r.currentUser.id?"bg-blue-100 ml-12":"bg-gray-100 mr-12"])},[i("div",Se,[i("span",Te,c(n.sender_id===r.currentUser.id?"You":"Support"),1),i("span",Fe,c(o.formatDate(n.created_at)),1)]),i("p",Ce,c(n.message),1)],2))),128))]))]),i("div",Oe,[M(i("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>t.newMessage=n),type:"text",placeholder:"Type your message...",class:"flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:s[2]||(s[2]=q((...n)=>o.sendMessage&&o.sendMessage(...n),["enter"]))},null,544),[[N,t.newMessage]]),i("button",{onClick:s[3]||(s[3]=(...n)=>o.sendMessage&&o.sendMessage(...n)),disabled:!t.newMessage.trim()||t.sending,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed"},c(t.sending?"Sending...":"Send"),9,Ye)])])])}const Ee=D(we,[["render",$e],["__scopeId","data-v-71704629"]]);export{Ae as M,Ee as S,qe as p};
